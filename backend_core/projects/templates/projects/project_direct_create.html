{% extends "contractor/contractor.html" %}
{% load staticfiles %}
{% load i18n %}
{% load account socialaccount %}
{% load widget_tweaks %}

{% block metainfo %}
    <link rel="stylesheet" href="{% static 'css/contractor.css' %}">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <style>
        .main {
            margin-top: 100px;
            margin-bottom: 10%;
        }

        .container {
            padding-left: 15px;
            padding-right: 15px;
            margin-left: auto;
            margin-right: auto;
        }

        .form-horizontal ul li {
            list-style-type: none;
        }

        .section-title {
            font-family: Roboto;
            font-size: 2em;
            margin-bottom: 12px;
            margin-left: 0px;
        }

        .form-horizontal .control-label {
            text-align: left;
        }

        .form-horizontal .col-sm-10 {
            padding-left: 10px;
        }

        #milestone .btn.btn-default {
            padding: 0 12px;
            height: 34px;
        }

        #milestone tr td:first-of-type, #milestone tr th:first-of-type {
            width: 160px;
        }
    </style>
{% endblock %}
{% block header %}
{% endblock %}
{% block content %}
    <div class="main container">
        <form method="post" enctype="multipart/form-data" class="form-horizontal" role="form"
              action="">
            {% csrf_token %}

            {% with form=info_dict.project_form %}
                <h1 class="section-title">{% trans 'Tell us what you need done' %}</h1>
                <br/>
                {#                non-field error#}
                {% for error in form.non_field_errors %}
                    <div class="form-group has-errors text-danger small">
                        {{ error }}
                    </div>
                {% endfor %}



                {#                                created_by#}
                {#                {% with field=form.created_by %}#}
                {#                    {% if field.errors %}#}
                {#                        <div class="form-group has-error">#}
                {#                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>#}
                {#                            <div class="col-sm-10">#}
                {#                                {{ field }}#}
                {#                                <span class="help-block">#}
                {#                                    {% for error in  field.errors %}{{ error }}{% endfor %}#}
                {#                                </span>#}
                {#                            </div>#}
                {#                        </div>#}
                {#                    {% else %}#}
                {#                        <div class="form-group">#}
                {#                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>#}
                {#                            <div class="col-sm-10">#}
                {#                                {{ field }}#}
                {#                                {% if field.help_text %}#}
                {#                                    <p class="help-block">#}
                {#                                        <small>{{ field.help_text }}</small>#}
                {#                                    </p>#}
                {#                                {% endif %}#}
                {#                            </div>#}
                {#                        </div>#}
                {#                    {% endif %}#}
                {#                {% endwith %}#}

                <div class="form-group">
                    <label class="col-sm-2 control-label" for="id_created_by">Choose your idenity*</label>
                    <div class="col-sm-10">
                        <ul id="id_created_by">
                            <li><label for="id_created_by_0"><input type="radio" name="created_by" value="PROFESSIONAL"
                                                                    required="" id="id_created_by_0">
                                {% trans 'Contractor/Meister' %}</label>

                            </li>
                            <li><label for="id_created_by_1"><input type="radio" name="created_by" value="CONSUMER"
                                                                    required="" id="id_created_by_1">
                                {{ Homeowner }}</label>

                            </li>
                        </ul>

                    </div>
                </div>

                <div class="professional_hoome_id_wrapper hide">
                    {#                                professional_hoome_id#}
                    {% with field=form.professional_hoome_id %}
                        {% if field.errors %}
                            <div class="form-group has-error">
                                <label class="col-sm-2 control-label"
                                       for="id_{{ field.name }}">{{ field.label }}</label>
                                <div class="col-sm-10">
                                    {{ field|attr:"class:form-control" }}
                                    <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                                    </span>
                                </div>
                            </div>
                        {% else %}
                            <div class="form-group">
                                <label class="col-sm-2 control-label"
                                       for="id_{{ field.name }}">{{ field.label }}</label>
                                <div class="col-sm-10">
                                    {{ field|attr:"class:form-control" }}
                                    {% if field.help_text %}
                                        <p class="help-block">
                                            <small>{{ field.help_text }}</small>
                                        </p>
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                    {% endwith %}
                </div>

                <div class="homeowner_hoome_id_wrapper hide">
                    {#                                homeowner_hoome_id#}
                    {% with field=form.homeowner_hoome_id %}
                        {% if field.errors %}
                            <div class="form-group has-error">
                                <label class="col-sm-2 control-label"
                                       for="id_{{ field.name }}">{{ field.label }}</label>
                                <div class="col-sm-10">
                                    {{ field|attr:"class:form-control" }}
                                    <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                                </div>
                            </div>
                        {% else %}
                            <div class="form-group">
                                <label class="col-sm-2 control-label"
                                       for="id_{{ field.name }}">{{ field.label }}</label>
                                <div class="col-sm-10">
                                    {{ field|attr:"class:form-control" }}
                                    {% if field.help_text %}
                                        <p class="help-block">
                                            <small>{{ field.help_text }}</small>
                                        </p>
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                    {% endwith %}
                </div>


                {#                                project_name#}
                {% with field=form.project_name %}
                    {% if field.errors %}
                        <div class="form-group has-error">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                {% if field.help_text %}
                                    <p class="help-block">
                                        <small>{{ field.help_text }}</small>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}

                {#                first_name#}
                {% with field=form.first_name %}
                    {% if field.errors %}
                        <div class="form-group has-error">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                {% if field.help_text %}
                                    <p class="help-block">
                                        <small>{{ field.help_text }}</small>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}

                {#                last_name#}
                {% with field=form.last_name %}
                    {% if field.errors %}
                        <div class="form-group has-error">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                {% if field.help_text %}
                                    <p class="help-block">
                                        <small>{{ field.help_text }}</small>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}

                {#                project_type#}
                {% with field=form.project_type %}
                    {% if field.errors %}
                        <div class="form-group has-error">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                {% if field.help_text %}
                                    <p class="help-block">
                                        <small>{{ field.help_text }}</small>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}

                {#                contract_price#}
                {% with field=form.contract_price %}
                    {% if field.errors %}
                        <div class="form-group has-error">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                {% if field.help_text %}
                                    <p class="help-block">
                                        <small>{{ field.help_text }}</small>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}

                {#                start_date#}
                {% with field=form.start_date %}
                    {% if field.errors %}
                        <div class="form-group has-error">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-inline">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class=>
                                {{ field|attr:"class:form-control" }}
                                {% if field.help_text %}
                                    <p class="help-block">
                                        <small>{{ field.help_text }}</small>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}
                <br/>
                {#                end_date#}
                {% with field=form.end_date %}
                    {% if field.errors %}
                        <div class="form-group has-error">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-inline">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>

                            {#                            <div class="col-sm-12">#}
                            {{ field|attr:"class:form-control" }}
                            {% if field.help_text %}
                                <p class="help-block">
                                    <small>{{ field.help_text }}</small>
                                </p>
                            {% endif %}
                            {#                            </div>#}

                        </div>
                    {% endif %}
                {% endwith %}
                <br/>

                {#                project_description#}
                {% with field=form.project_description %}
                    {% if field.errors %}
                        <div class="form-group has-error">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                {% if field.help_text %}
                                    <p class="help-block">
                                        <small>{{ field.help_text }}</small>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}
                <br>
                <h1 class="section-title">{% trans 'Please enter the project address' %}</h1>
                <small>{% trans 'Note: hoome will not show this address in public.' %}</small>
                <br/> <br/>
                {#                street_address#}
                {% with field=form.street_address %}
                    {% if field.errors %}
                        <div class="form-group has-error">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                {% if field.help_text %}
                                    <p class="help-block">
                                        <small>{{ field.help_text }}</small>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}

                {#                Apt #, Suite #, ...#}
                {% with field=form.street_address2 %}
                    {% if field.errors %}
                        <div class="form-group has-error">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                {% if field.help_text %}
                                    <p class="help-block">
                                        <small>{{ field.help_text }}</small>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}

                {#                county#}
                {% with field=form.county %}
                    {% if field.errors %}
                        <div class="form-group has-error">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                {% if field.help_text %}
                                    <p class="help-block">
                                        <small>{{ field.help_text }}</small>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}

                {#                state#}
                {% with field=form.state %}
                    {% if field.errors %}
                        <div class="form-group has-error">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                {% if field.help_text %}
                                    <p class="help-block">
                                        <small>{{ field.help_text }}</small>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}

                {#                zipcode#}
                {% with field=form.zipcode %}
                    {% if field.errors %}
                        <div class="form-group has-error">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                {% if field.help_text %}
                                    <p class="help-block">
                                        <small>{{ field.help_text }}</small>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}
                <br/>

                <h1 class="section-title">{% trans 'Attach any documents/photos if you would like' %}</h1>
                <br/>
                {#                attachment_type#}
                {% with field=form.attachment_type %}
                    {% if field.errors %}
                        <div class="form-group has-error">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                {% if field.help_text %}
                                    <p class="help-block">
                                        <small>{{ field.help_text }}</small>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}

                {#                project_attachment#}
                {% with field=form.project_attachment %}
                    {% if field.errors %}
                        <div class="form-group has-error">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                <span class="help-block">
                        {% for error in  field.errors %}{{ error }}{% endfor %}
                    </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field }}
                                {% if field.help_text %}
                                    <p class="help-block">
                                        <small>{{ field.help_text }}</small>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}

                {#                project_photo#}
                {% with field=form.project_photo %}
                    {% if field.errors %}
                        <div class="form-group has-error">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field|attr:"class:form-control" }}
                                <span class="help-block">
                                    {% for error in  field.errors %}{{ error }}{% endfor %}
                                </span>
                            </div>
                        </div>
                    {% else %}
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                            <div class="col-sm-10">
                                {{ field }}
                                {% if field.help_text %}
                                    <p class="help-block">
                                        <small>{{ field.help_text }}</small>
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                {% endwith %}

                {{ info_dict.milestone_formset.management_form }}
                <h1 class="section-title">{{ Milestone }}</h1>
                <br>
                {% if milestone_form.non_form_errors %}
                    {% for error in milestone_form.non_form_errors %}
                        {{ error|escape }}
                    {% endfor %}
                {% endif %}
                <table id='milestone' width="100%">
                    <tr>
                        <th>{{ Milestone_Number }}</th>
                        <th>{{ Amount }}</th>
                    </tr>
                    {#                    <span class="input-group-btn hide">#}

                    {#                        </span>#}

                    {% for milestone_form in info_dict.milestone_formset %}

                        <tr class="milestone-formset">
                            <td>{{ forloop.counter }}</td>
                            <td>
                                {% if milestone_form.amount.errors %}
                                    {% for error in milestone_form.amount.errors %}
                                        {{ error|escape }}
                                    {% endfor %}
                                {% endif %}
                                <div class="form-inline">
                                    <label class="sr-only"
                                           for="id_{{ milestone_form.amount.name }}">{{ milestone_form.amount.label }}</label>
                                    <div class="input-group">
                                        <div class="input-group-addon">$</div>
                                        {{ milestone_form.amount|attr:"class:form-control " }}
                                        <div class="input-group-addon">.00</div>
                                        <span class="input-group-btn ">
                                            <button class="btn btn-danger btn-default"
                                                    type="button">
                                                <span class=" glyphicon glyphicon-minus"></span>
                                            </button>
                                            <button class="btn btn-success btn-default" type="button">
                                                <span class=" glyphicon glyphicon-plus"></span>
                                            </button>
                                        </span>
                                    </div>
                                    <p class="help-block">
                                        <small>{{ milestone_form.amount.help_text }}</small>
                                    </p>
                                </div>
                            </td>
                        </tr>
                        <br>
                    {% endfor %}
                </table>

                <br/>
                <br/>
                <script src='https://www.google.com/recaptcha/api.js'></script>
                <div class="g-recaptcha" data-sitekey="6LdWazUUAAAAAFcK-GyEJGerzK1pRY4G15JyVyh0"></div>
                <br/>
                <button class="btn btn-hoome" type="submit" value="submit" name="submit">{{ Create }}</button>
            {% endwith %}
        </form>
    </div>
    <script>
        {#    TODO: need to write a more generic one#}
{#        {{   info_dict.project_form.created_by  }}#}
{#        {% if info_dict.project_form == '' %}#}
{#            $("#id_created_by_1").prop("checked", true);#}
{#        {% else %}#}
{#            $("#id_created_by_0").prop("checked", true);#}
{#        {% endif %}#}
        function addForm(index, form_count) {
            var content_html =
                '<tr class="milestone-formset">' +
                '<td>' + index + '</td>' +
                '<td>' +
                '<div class="form-inline">' +
                '<label class="sr-only" for="id_amount">Amount</label>' +
                '<div class="input-group">' +
                '<div class="input-group-addon">$</div>' +
                '<input type="number" name="form-' + form_count + '-amount" id="id_form-' + form_count + '-amount" class="form-control " min="0">' +
                '<div class="input-group-addon">.00</div>' +
                '<span class="input-group-btn">' +
                '<button class="btn btn-danger btn-default" type="button">' +
                '<span class=" glyphicon glyphicon-minus"></span>' +
                '</button>' +
                '<button class="btn btn-success btn-default" type="button">' +
                '<span class=" glyphicon glyphicon-plus"></span>' +
                '</button>' +
                '</span>' +
                '</div>' +
                '<p class="help-block">' +
                '<small></small>' +
                '</p>' +
                '</div>' +
                '</td>' +
                '</tr>'
            {#            if (index > 1) {#}
            {#                $('#milestone tr:nth-of-type(2) .input-group-btn').removeClass('hide');#}
            {#            } else {#}
            {#                if (!$('#milestone tr:nth-of-type(2) .input-group-btn').hasClass('hide')) {#}
            {#                    $('#milestone tr:nth-of-type(2) .input-group-btn').addClass('hide');#}
            {#                }#}
            {##}
            {#            }#}
            {#            $('#milestone tr:last button').removeClass('btn-success').addClass('btn-danger');#}
            {#            $('#milestone tr:last button span').removeClass('glyphicon-plus').addClass('glyphicon-minus');#}
            $('#milestone tr:last').after(content_html);
            $('#milestone tr:nth-of-type('+(index)+') .btn.btn-success.btn-default').remove();
        }

        function hideth() {
            var index = document.getElementById('milestone').getElementsByTagName("tr").length;
            if (index == 1) {
                $('#milestone tr:nth-of-type(1)').addClass('hide');
            } else {
                if ($('#milestone tr:nth-of-type(1)').hasClass('hide')) {
                    $('#milestone tr:nth-of-type(1)').removeClass('hide');
                }

            }
        }

        hideth();

        function removeForm(obj) {
            if ($(obj).closest("tr").is(":last-child")) {
                $(obj).closest('tr').prev('tr').find('button').after('<button class="btn btn-success btn-default" type="button"><span class="glyphicon glyphicon-plus"></span></button>');
            }
            obj.closest('tr').remove();
            {#            var rows = document.getElementById('milestone').getElementsByTagName("tr").length;#}
            {#            var count = 1;#}
            $('#milestone .milestone-formset').each(function (index) {
                $(this).find('td').first().html(index + 1);
            })
        }

        var form_count = 0;
        $('#milestone').on('click', '.btn.btn-success.btn-default', function () {
            form_count++;
            var rows = document.getElementById('milestone').getElementsByTagName("tr").length;
            addForm(rows, form_count);
            hideth();
        })

        $('#milestone').on('click', '.btn.btn-danger.btn-default', function () {
            removeForm($(this));
            hideth();
        })

        function check_identity(identity) {
            if ($("#id_created_by_0").is(':checked')) {
                $(".homeowner_hoome_id_wrapper").removeClass('hide');
                if (!$(".professional_hoome_id_wrapper").hasClass('hide')) {
                    $(".professional_hoome_id_wrapper").addClass('hide');
                }
                return $("#id_created_by_0").val();
            }

            else if ($("#id_created_by_1").is(':checked')) {
                $(".professional_hoome_id_wrapper").removeClass('hide');
                if (!$(".homeowner_hoome_id_wrapper").hasClass('hide')) {
                    $(".homeowner_hoome_id_wrapper").addClass('hide');
                }
                return $("#id_created_by_1").val();
            }
        }

        $(document).ready(function () {
            var identity;
            {#            changeformset();#}

            identity = check_identity(identity);
            $("#id_created_by input").click(function () {
                identity = check_identity(identity);
            })

            $("button.btn.btn-hoome").click(function () {
                if (!(localStorage.getItem("role") === null)) {
                    localStorage.removeItem("role");
                }
                localStorage.setItem("role", identity);
            });
        })

    </script>
{% endblock %}