{% extends 'base.html' %}
{% load staticfiles %}

{#style#}

{% block metainfo %}

    <link rel="stylesheet" href="{% static 'css/contractor.css' %}">
    <!-- Add the slick-theme.css if you want default styling -->
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/kenwheeler/slick@1.8.0/slick/slick.css"/>
    <!-- Add the slick-theme.css if you want default styling -->
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/kenwheeler/slick@1.8.0/slick/slick-theme.css"/>
    <script type="text/javascript" src="//cdn.jsdelivr.net/gh/kenwheeler/slick@1.8.0/slick/slick.min.js"></script>
    <style>
        #masthead {
            width: auto;
            background: url('{{ info_dict.bg_image.img.url }}') no-repeat center;
            background-size: cover;
            min-height: 300px;
            display: flex;
            padding: 0px;
            margin-top: 50px;
            box-sizing: border-box;
        }
    </style>
    <script>
        $(document).ready(function () {
            var curHeight = $('#Summary .text').height();
            if (curHeight >= 350) {

                $('#readmore').show();
            }
            else {
                $('#readmore').hide();
                $('#peek').removeClass('link');
            }
        });
    </script>
{% endblock %}



{#header#}
{#{% block nav %}#}
{#  TODO: change the color of pop out menu #}
{#    <header class="navbar navbar-bright navbar-fixed-top" role="banner">#}
{#        <div class="container">#}
{#            <div class="navbar-header">#}
{#                <a href="/" class="navbar-brand">#}
{#                    <h1 class="logo cursive">#}
{#                        Hoome#}
{#                    </h1>#}
{#                </a>#}
{#                <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">#}
{#                    <span class="sr-only">Toggle navigation</span>#}
{#                    <span class="icon-bar"></span>#}
{#                    <span class="icon-bar"></span>#}
{#                    <span class="icon-bar"></span>#}
{#                </button>#}
{##}
{#            </div>#}
{#            <nav class="collapse navbar-collapse" role="navigation">#}
{#                <ul class="nav navbar-nav">#}
{#                    <li><a href="/">Find your address</a></li>#}
{#                    <li><a href="/">Projects</a></li>#}
{#                    <li><a href="{% url 'login' %}">User Sign In</a></li>#}
{#                    <li><a href="#">Contractor Sign In</a></li>#}
{#                </ul>#}
{#            </nav>#}
{#        </div>#}
{#    </header>#}
{#{% endblock %}#}

{% block header %}
    <div id="masthead">
        <div class="container">
            <div class="row">
                <div class="col-md-8 col-lg-8 head-info">
                    <h1>{{ info_dict.contractor.bus_name }}</h1>
                    <div class="horizontal-list">
                        <ul style="list-style-type:None;">
                            <li>{{ info_dict.contractor.csp }}</li>
                            <li>Score: {{ info_dict.score }}</li>
                            <li>Phone: {{ info_dict.contractor.phone }}</li>
                            <li>Overall Rating:{% for key,value in info_dict.ratings.overall %} {{ key }} {% endfor %}
                                <div class="star-ratings-css">
                                    <div class="star-ratings-css-top" style="width:100%">
                                        {% for i in info_dict.ratings.stars %}
                                            <span>★</span>
                                        {% endfor %}
                                    </div>
                                    <div class="star-ratings-css-bottom">
                                        {% for i in info_dict.ratings.stars %}
                                            <span>★</span>
                                        {% endfor %}
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-4 col-lg-4">

                </div>
            </div>
        </div>
    </div>
    <!-- /cont -->
{% endblock %}

{% block content %}
    <!-- Begin Body -->
    <div id="contractor-content">
        <div class="container">
            <div class='menu justify-content-center' id='pro-menu'>
                <ul class='nav  nav-pills'>
                    <li class="nav-item">
                        <a class="nav-link" id="overview-tab">Overview</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="projectphotos-tab">Project Photos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="review-tab">Review</a>
                    </li>
                    {#                    <li class="nav-item">#}
                    {#                        <a class="nav-link" id="other-tab">Other</a>#}
                    {#                    </li>#}
                </ul>
            </div>

            <div class="" id="">
                <div id="pro-content">
                    {% include "contractor/contractor_overview.html" %}
                </div>
            </div>
        </div>
    </div>
    </div>
{% endblock %}



{% block javascript %}

    <script>

        var a = document.getElementById('pro-content').innerHTML;
        var b;
        var c;
        {#        var d;#}

        function readMore() {
            var curHeight = $('#Summary .text').height();
            if (curHeight >= 350) {

                $('#readmore').show();
            }
            else {
                $('#readmore').hide();
                $('#peek').removeClass('link');
            }
            var readmore = $('#readmore');
            if (readmore.text() == 'Read more') {
                readmore.text("Read less");
                $('#peek').removeClass('link');
            } else {
                readmore.text("Read more");
                $('#peek').addClass('link');
            }
            $('.height').toggleClass("heightAuto");
        }


        function photoSlider() {
            $(".project-detail").slick({
                slidesToShow: 1,
                arrows: false,
                asNavFor: '.project-strip',
                autoplay: true,
                autoplaySpeed: 3000
            });

            $(".project-strip").slick({
                slidesToShow: 3,
                slidesToScroll: 1,
                arrows: false,
                asNavFor: '.project-detail',
                dots: false,
                infinite: true,
                centerMode: true,
                focusOnSelect: true,
            });
        }

        photoSlider();

        function projectPhotosListener() {
            if (b) {
                $('#pro-content').html(b);
            }
            else {
                $.ajax({
                    type: "POST",
                    beforeSend: function (request) {
                        request.setRequestHeader("X-CSRFToken", getCookie("csrftoken"));
                    },
                    url: '{% url 'contractor_project_photos' info_dict.contractor.lic_num %}',
                    dataType: 'html',
                })
                    .done(function (data) {
                        b = data;
{#                        TODO:NEED TO CHECK THE FUNCTIONALITY#}
                        function photoSlider(){return true;}
                        photoSlider();
                        $('#pro-content').html(b);


                    });
            }
        }

        function reviewListener() {
            if (c) {
                $('#pro-content').html(c);
            }
            else {
                $.ajax({
                    type: "POST",
                    url: '{% url 'contractor_review' info_dict.contractor.lic_num %}',
                    beforeSend: function (request) {
                        request.setRequestHeader("X-CSRFToken", getCookie("csrftoken"));
                    },
                    dataType: 'html',
                })
                    .done(function (data) {
                        c = data;
                        $('#pro-content').html(c);
                    });
            }
        }


        $(document).ready(function () {

            $('#readmore').click(function () {
                readMore();
            });

            $('#overview-tab').click(function () {
                document.getElementById('pro-content').innerHTML = a;
                {#                $('#pro-content').html(a);#}
                var curHeight = $('#Summary .text').height();
                if (curHeight >= 350) {
                    $('#readmore').show();
                }
                else {
                    $('#readmore').hide();
                    $('#peek').removeClass('link');
                }

                $('#readmore').click(function () {
                    readMore();
                });
                photoSlider();
                $('#photo a.viewmore').click(function () {
                    projectPhotosListener();
                });
            });

            $('#projectphotos-tab').click(function () {
                projectPhotosListener();
            });
            $('#photo a.viewmore').click(function () {
                projectPhotosListener();
            });


            $('#review-tab').click(function () {
                reviewListener();
            });

            $('#review a.viewmore').click(function () {
                reviewListener();
            });

            {#            $('.video-content-wrapper').slick({#}
            {#                centerMode: true,#}
            {#                varaibleWidth: true,#}
            {#                slidesToShow: 1.5,#}
            {#                responsive: [#}
            {#                    {#}
            {#                        breakpoint: 768,#}
            {#                        settings: {#}
            {#                            arrows: false,#}
            {#                            centerMode: true,#}
            {#                            varaibleWidth: true,#}
            {#                            slidesToShow: 1.2#}
            {#                        }#}
            {#                    },#}
            {#                    {#}
            {#                        breakpoint: 480,#}
            {#                        settings: {#}
            {#                            arrows: false,#}
            {#                            centerMode: true,#}
            {#                            varaibleWidth: true,#}
            {#                            slidesToShow: 1.5#}
            {#                        }#}
            {#                    }#}
            {#                ]#}
            {#            });#}

        })
        ;
    </script>
{% endblock %}
